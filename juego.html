<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vitalis | Cl√≠nica Odontol√≥gica</title>
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="img/android-chrome-192x192.png">
    <link rel="icon" href="img/favicon.ico">
    <link rel="stylesheet" href="style.css">

</head>
<body>

    <nav>
     <div class="logo-container">
    <a href="index.html">
        <img src="img/logo.jpg" alt="Vitalis" class="logo-img" style="height: 50px;">
    </a>
</div>
    
    <div class="hamburger" onclick="toggleMenu()">
        ‚ò∞
    </div>

    <div class="nav-links" id="menu-links">
        <a href="index.html">Inicio</a>
        <a href="especialidades.html">Especialidades</a>
        <a href="equipo.html">Equipo</a>
        <a href="educacion.html">Informacion educativa</a>
        <a href="juego.html">Juega y gana descuentos</a>
        <a href="contacto.html">Contacto</a>
    </div>
</nav>

    <header class="hero">
        <h1>Tu sonrisa en manos expertas</h1>
        <p>Gabriela Mistral 79, Malalhue</p>
        <a href="https://wa.me/56957006747" class="btn-whatsapp">Agendar Evaluaci√≥n</a>
    </header>

<section id="vitalis-game-widget">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        /* ESTILOS DEL WIDGET (Aislados) */
        #vitalis-game-widget {
            --v-bg: #EBF5FB; --v-primary: #29B6F6; --v-dark: #01579B;
            --v-white: #FFFFFF; --v-success: #66BB6A; --v-error: #EF5350;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--v-bg); color: var(--v-dark);
            border-radius: 20px; padding: 20px; max-width: 500px; margin: 0 auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05); position: relative;
        }
        #vitalis-game-widget * { box-sizing: border-box; }
        .v-hidden { display: none !important; }

        /* HEADER */
        .v-header {
            background: linear-gradient(135deg, #ffffff 0%, #E1F5FE 100%);
            padding: 10px 15px; border-radius: 15px; display: flex;
            justify-content: space-between; align-items: center; margin-bottom: 20px;
        }
        .v-logo {
            width: 45px; height: 45px; border-radius: 50%; 
            border: 2px solid var(--v-primary); overflow: hidden; background: white;
        }
        .v-logo img { width: 100%; height: 100%; object-fit: contain; }

        /* PANTALLAS */
        .v-screen { background: var(--v-white); padding: 20px; border-radius: 20px; text-align: center; animation: vFade 0.4s; }
        @keyframes vFade { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        /* UI ELEMENTS */
        .v-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #B3E5FC; border-radius: 10px; font-size: 1rem;}
        .v-btn { border: none; padding: 12px; border-radius: 50px; width: 100%; cursor: pointer; font-weight: bold; margin-top: 10px; font-size: 1rem; }
        .v-btn-primary { background: var(--v-primary); color: white; box-shadow: 0 4px 10px rgba(41, 182, 246, 0.4); }
        .v-btn-secondary { background: transparent; color: var(--v-primary); border: 2px solid var(--v-primary); }
        
        /* JUEGO */
        .v-opt-btn { width: 100%; padding: 15px; margin-bottom: 8px; border-radius: 10px; border: 2px solid #eee; background: white; cursor: pointer; text-align: left; font-size: 0.95rem; transition: 0.2s; }
        .v-opt-btn:hover { background: #f9f9f9; }
        .v-correct { background: #E8F5E9 !important; border-color: #66BB6A !important; color: #2E7D32; }
        .v-wrong { background: #FFEBEE !important; border-color: #EF5350 !important; color: #C62828; }
        
        .v-progress-track { background: #ECEFF1; height: 8px; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .v-progress-fill { background: var(--v-primary); height: 100%; width: 0%; transition: width 0.3s; }

        .v-level-item { padding: 15px; border-radius: 10px; background: white; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid var(--v-primary); cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .v-locked { opacity: 0.6; background: #f0f0f0; border-color: #ccc; pointer-events: none; }

        /* TABLA */
        .v-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
        .v-table th { text-align: left; color: var(--v-primary); border-bottom: 2px solid #eee; padding: 5px;}
        .v-table td { padding: 8px 5px; border-bottom: 1px solid #f5f5f5; }
        .v-user-row { background: #E1F5FE; font-weight: bold; }
    </style>

    <div class="v-header">
        <div style="display:flex; gap:10px; align-items:center;">
            <div class="v-logo">
                <img src="img/logo.jpg" alt="Vitalis">
            </div>
            <div style="text-align:left;">
                <div style="font-weight:800; line-height:1; font-size: 1.1rem;">Vitalis</div>
                <div style="font-size:0.75rem; color:#666;">Cl√≠nica Odontol√≥gica</div>
            </div>
        </div>
        <div id="v-score-ui" class="v-hidden" style="color:var(--v-primary); font-weight:bold;">0 pts</div>
    </div>

    <div id="v-app-container">
        
        <div id="v-scr-login" class="v-screen">
            <div style="font-size:3rem;">üëã</div>
            <h2 style="color:var(--v-primary); margin-top:0;">¬°Bienvenido!</h2>
            <p style="font-size:0.9rem; color:#555;">Demuestra cu√°nto sabes y gana premios.</p>
            <form onsubmit="vGame.login(event)">
                <input id="v-in-name" class="v-input" placeholder="Nombre del Paciente" required>
                <input id="v-in-phone" type="tel" class="v-input" placeholder="Tel√©fono (para guardar r√©cord)" required>
                <button type="submit" class="v-btn v-btn-primary">Comenzar Aventura</button>
                <button type="button" class="v-btn v-btn-secondary" onclick="vGame.showRanking()">Ver Ranking Semanal</button>
            </form>
        </div>

        <div id="v-scr-menu" class="v-screen v-hidden">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                <div style="font-size:2.5rem;">ü¶∑</div>
                <div style="text-align:left;">
                    <div style="font-size:0.8rem; color:#666;">Hola, <b id="v-lbl-name"></b></div>
                    <div style="font-weight:bold; font-size:0.9rem;">¬°Completa los 5 niveles!</div>
                </div>
            </div>
            <div id="v-levels-list"></div>
            <button class="v-btn v-btn-secondary" onclick="vGame.showRanking()">Ver Ranking</button>
        </div>

        <div id="v-scr-game" class="v-screen v-hidden">
            <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#888; margin-bottom:10px;">
                <span id="v-lbl-lvlname">Nivel 1</span>
                <span id="v-lbl-counter">1/6</span>
            </div>
            <div class="v-progress-track"><div id="v-bar" class="v-progress-fill"></div></div>
            
            <div id="v-lbl-emoji" style="font-size:3.5rem; margin-bottom:10px;">ü§î</div>
            <p id="v-lbl-text" style="font-weight:600; font-size:1.1rem; margin-bottom:20px;">Pregunta...</p>
            
            <div id="v-options-box"></div>
            
            <div id="v-hint-box" style="display:none; background:#FFF3E0; border:1px solid #FFCC80; padding:10px; border-radius:10px; margin-top:15px; font-size:0.9rem; text-align:left; color:#E65100;">
                üí° <b>Pista:</b> <span id="v-lbl-hint"></span>
            </div>

            <button id="v-btn-next" class="v-btn v-btn-primary v-hidden" onclick="vGame.next()">Siguiente Pregunta</button>
        </div>

        <div id="v-scr-blocked" class="v-screen v-hidden">
            <div style="font-size:3rem;">‚è≥</div>
            <h3>¬°Ya jugaste esta semana!</h3>
            <p>Solo puedes registrar un puntaje por semana. ¬°Vuelve el lunes para intentar superar tu r√©cord!</p>
            <button class="v-btn v-btn-secondary" onclick="vGame.showRanking()">Ver Ranking</button>
        </div>

        <div id="v-scr-result" class="v-screen v-hidden">
            <div style="font-size:3rem;">üéâ</div>
            <h2 style="color:var(--v-primary);">¬°Misi√≥n Cumplida!</h2>
            <div id="v-final-score" style="font-size:3.5rem; font-weight:800; color:var(--v-dark);">0</div>
            <p>Puntos Totales</p>

            <div id="v-coupon" class="v-hidden" style="background:#FFF8E1; border:2px dashed #FFCA28; padding:15px; border-radius:10px; margin:20px 0;">
                <strong style="color:#FF6F00;">üåü ¬°PREMIO DESBLOQUEADO!</strong><br>
                Muestra este c√≥digo en recepci√≥n:<br>
                <span style="font-size:1.5rem; letter-spacing:2px; font-weight:bold; background:white; padding:5px 10px; display:inline-block; margin-top:5px; border:1px solid #FFCA28;">DIENTE20</span>
            </div>

            <button class="v-btn v-btn-primary" onclick="vGame.showRanking()">Ver mi Ranking</button>
        </div>

        <div id="v-scr-ranking" class="v-screen v-hidden">
            <h3 style="color:var(--v-primary); margin-top:0;">üèÜ Ranking Semanal</h3>
            <table class="v-table">
                <thead><tr><th>#</th><th>Paciente</th><th style="text-align:right;">Pts</th></tr></thead>
                <tbody id="v-rank-body"><tr><td colspan="3">Cargando...</td></tr></tbody>
            </table>
            <br>
            <button class="v-btn v-btn-secondary" onclick="location.reload()">Volver al Inicio</button>
        </div>

    </div>

    <script>
        // ======================================================
        // 1. CONFIGURACI√ìN DE FIREBASE (¬°RELLENA ESTO!)
        // ======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyD9iJbkJaiTPPxw2eJNKlqVIlZhGuz5nHo",
            authDomain: "vitalis-juego.firebaseapp.com",
            projectId: "vitalis-juego",
            storageBucket: "vitalis-juego.firebasestorage.app",
            messagingSenderId: "462223136582",
            appId: "1:462223136582:web:f7ebb98f36833478aa3747"
        };
        // ======================================================

        // Inicializar Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            var db = firebase.firestore();
            console.log("Firebase conectado correctamente");
        } catch(e) {
            console.error("Error conectando Firebase. Revisa la config.", e);
        }

        const vGame = (function() {
            
            // --- BASE DE DATOS COMPLETA (5 NIVELES) ---
            const levelsData = [
                { 
                    id: 1, name: "Nivel 1: Anatom√≠a B√°sica", count: 6, qs: [
                        {e:"üõ°Ô∏è", t:"¬øCu√°l es la capa m√°s externa y dura del diente?", o:["El Esmalte","La Dentina","La Pulpa","La Enc√≠a"], a:0, h:"Es la parte blanca y brillante que ves al sonre√≠r."},
                        {e:"üë∂", t:"¬øCu√°ntos dientes de leche tiene un ni√±o?", o:["32 dientes","20 dientes","10 dientes","50 dientes"], a:1, h:"Son 10 arriba y 10 abajo."},
                        {e:"‚öì", t:"¬øQu√© parte del diente lo mantiene pegado al hueso?", o:["La Corona","El Esmalte","La Ra√≠z","La Lengua"], a:2, h:"Es la parte larga que est√° escondida bajo la enc√≠a."},
                        {e:"üíó", t:"¬øC√≥mo se llama la parte rosada que rodea los dientes?", o:["Labio","Mejilla","Enc√≠a","Paladar"], a:2, h:"Es suave, de color rosa y protege el cuello del diente."},
                        {e:"‚ö°", t:"¬øQu√© hay justo en el centro del diente?", o:["Hueso","Aire","Pulpa (Nervio)","Agua"], a:2, h:"Es la parte viva que siente el fr√≠o y el calor."},
                        {e:"üßõ", t:"¬øQu√© dientes usamos para desgarrar la comida?", o:["Molares","Incisivos","Caninos (Colmillos)","Premolares"], a:2, h:"Son los dientes puntiagudos en las esquinas."},
                    ]
                },
                { 
                    id: 2, name: "Nivel 2: Higiene Diaria", count: 7, qs: [
                        {e:"ü™•", t:"¬øCu√°l es la cantidad m√≠nima de veces que debes cepillarte al d√≠a?", o:["1 vez","2 veces","5 veces","Solo los domingos"], a:1, h:"Una por la ma√±ana y otra (la m√°s importante) por la noche."},
                        {e:"üßµ", t:"¬øQu√© herramienta sirve para limpiar ENTRE los dientes?", o:["Cepillo normal","Enjuague bucal","Hilo Dental","Palillos"], a:2, h:"Es un hilo muy fino que entra donde el cepillo no llega."},
                        {e:"ü¶†", t:"¬øQu√© comen las bacterias para producir caries?", o:["Agua","Az√∫car","Verduras","Aire"], a:1, h:"Les encantan los dulces y golosinas."},
                        {e:"üìÖ", t:"¬øCada cu√°nto tiempo debes cambiar tu cepillo de dientes?", o:["Cada 3 meses","Cada a√±o","Nunca","Cada semana"], a:0, h:"O antes si las cerdas est√°n abiertas y despeinadas."},
                        {e:"ü¶∑", t:"¬øQu√© pasta de dientes ayuda a fortalecer el esmalte?", o:["Con Sabor a fresa","Con Fl√∫or","Con Az√∫car","Con Sal"], a:1, h:"El Fl√∫or es el mineral que hace al diente m√°s fuerte."},
                        {e:"ü©∏", t:"Si te sangra la enc√≠a al cepillar, ¬øqu√© debes hacer?", o:["Dejar de cepillar","Cepillar mejor esa zona","Comer helado","No hacer nada"], a:1, h:"Sangra porque hay bacterias. Si limpias bien, deja de sangrar."},
                        {e:"üçè", t:"¬øQu√© alimento ayuda a limpiar tus dientes al morderlo?", o:["Galletas","Manzana","Caramelo","Pan"], a:1, h:"Es una fruta dura y fibrosa que barre la suciedad."}
                    ]
                },
                { 
                    id: 3, name: "Nivel 3: Situaciones Reales", count: 7, qs: [
                        {e:"ü•§", t:"Est√°s en el cine y pides una Gaseosa (Soda). ¬øPor qu√© es mala para tus dientes?", o:["Porque est√° fr√≠a","Tiene mucho √Åcido y Az√∫car","Porque tiene gas","No es mala"], a:1, h:"El √°cido ablanda el diente y el az√∫car alimenta bacterias."},
                        {e:"‚ùÑÔ∏è", t:"Muerdes un helado y sientes un dolor r√°pido y agudo. ¬øQu√© podr√≠a ser?", o:["Sensibilidad dental","Que el helado est√° malo","Es normal","Dolor de cabeza"], a:0, h:"Ocurre cuando el esmalte est√° desgastado o hay una caries."},
                        {e:"üçæ", t:"No tienes destapador y quieres abrir una botella con los dientes. ¬øLo haces?", o:["S√≠, soy fuerte","Claro que s√≠","¬°Nunca! Se pueden romper","Solo una vez"], a:2, h:"Los dientes son joyas, no herramientas."},
                        {e:"üò¥", t:"Te vas a dormir sin lavarte los dientes. ¬øQu√© pasa en la noche?", o:["Nada","Las bacterias atacan m√°s porque hay menos saliva","Los dientes descansan","Se caen"], a:1, h:"La saliva nos protege, pero al dormir la boca se seca."},
                        {e:"ü§ê", t:"¬øQu√© pasa si te chupas el dedo hasta muy grande?", o:["Los dientes se enchuecan","Se ponen blancos","Crecen m√°s r√°pido","Nada"], a:0, h:"El dedo empuja los dientes hacia afuera y deforma la mordida."},
                        {e:"üëÖ", t:"¬øPor qu√© es importante cepillar tambi√©n la lengua?", o:["Para que se vea rosa","Para evitar el mal aliento","Para saborear mejor","No es necesario"], a:1, h:"La lengua guarda muchas bacterias que causan mal olor."},
                        {e:"üöë", t:"Jugando f√∫tbol se te sale un diente definitivo entero (con ra√≠z). ¬øQu√© haces?", o:["Lo boto","Lo lavo con jab√≥n","Lo pongo en leche y voy al dentista","Lloro"], a:2, h:"¬°Nunca lo laves con jab√≥n! La leche ayuda a mantenerlo vivo para reimplantarlo."}
                    ]
                },
                { 
                    id: 4, name: "Nivel 4: Anatom√≠a Avanzada", count: 7, qs: [
                        {e:"üèóÔ∏è", t:"¬øPara qu√© sirve el Ligamento Periodontal?", o:["Para que el diente se vea blanco","Amortigua y une el diente al hueso","Produce saliva","Cubre la corona"], a:1, h:"Es como un 'colch√≥n' el√°stico entre la ra√≠z y el hueso."},
                        {e:"üíé", t:"¬øCu√°l es la sustancia biol√≥gica m√°s dura de todo el cuerpo humano?", o:["El Hueso","El Esmalte Dental","Las U√±as","El Cr√°neo"], a:1, h:"Es incluso m√°s duro que tus huesos."},
                        {e:"üö™", t:"Las muelas tienen grietas profundas. ¬øQu√© tratamiento las cubre para evitar caries?", o:["Sellantes","Frenillos","Extracci√≥n","Blanqueamiento"], a:0, h:"Es una capa pl√°stica que tapa los surcos para que no entre comida."},
                        {e:"üë¥", t:"¬øC√≥mo se llaman las √∫ltimas muelas que salen (entre los 17 y 21 a√±os)?", o:["Premolares","Caninos","Muelas del Juicio","Incisivos"], a:2, h:"A veces no tienen espacio para salir y hay que sacarlas."},
                        {e:"ü§§", t:"¬øCu√°l es la funci√≥n principal de la Saliva?", o:["Solo mojar la comida","Neutralizar √°cidos y proteger dientes","Darnos sed","Ninguna"], a:1, h:"Es el defensor natural de tu boca contra el ataque √°cido."},
                        {e:"üß±", t:"¬øQu√© es el Sarro?", o:["Placa bacteriana endurecida","Restos de comida","Manchas de caf√©","Diente roto"], a:0, h:"Cuando la placa no se limpia, se calcifica y se pone dura como piedra."},
                        {e:"üò¨", t:"¬øQu√© es el Bruxismo?", o:["Comer mucho","Rechinar o apretar los dientes al dormir","Tener caries","Miedo al dentista"], a:1, h:"Suele pasar cuando est√°s estresado y desgasta los dientes."}
                    ]
                },
                { 
                    id: 5, name: "Nivel 5: Experto Vitalis", count: 7, qs: [
                        {e:"üì∏", t:"¬øQu√© usa el dentista para ver DENTRO del hueso y entre los dientes?", o:["Lupa","Espejo","Radiograf√≠a","Microscopio"], a:2, h:"Una imagen en blanco y negro que revela lo invisible."},
                        {e:"ü§¢", t:"¬øQu√© es la Halitosis?", o:["Dientes blancos","Tener frenillos","Mal aliento cr√≥nico","Dolor de muelas"], a:2, h:"Es el t√©rmino m√©dico para el olor desagradable de la boca."},
                        {e:"üöß", t:"¬øQu√© hacen los 'Brackets' o Frenillos?", o:["Liman los dientes","Mueven los dientes a su posici√≥n correcta","Solo decoran","Blanquean"], a:1, h:"Usan fuerzas suaves para alinear tu sonrisa."},
                        {e:"üç¨", t:"¬øQu√© tipo de dulce es el M√ÅS da√±ino para los dientes?", o:["Chocolate","Caramelo pegajoso (Masticable)","Helado","Gelatina"], a:1, h:"Al pegarse al diente, el az√∫car ataca por mucho m√°s tiempo."},
                        {e:"üõ°Ô∏è", t:"¬øCu√°l es la mejor forma de NO tener dolor de muelas nunca?", o:["Tomar pastillas","La Prevenci√≥n (Revisiones y limpieza)","No comer nada","Usar enjuague"], a:1, h:"Ir al dentista antes de que duela es el secreto."},
                        {e:"üë®‚Äç‚öïÔ∏è", t:"¬øQui√©n es el especialista en ni√±os?", o:["El Ortodoncista","El Odontopediatra","El Cirujano","El Periodoncista"], a:1, h:"Odonto = Diente, Pediatra = Ni√±os."},
                        {e:"üèÅ", t:"¬øD√≥nde consigues la mejor sonrisa?", o:["En la panader√≠a","En Vitalis Cl√≠nica Odontol√≥gica","En el parque","En la farmacia"], a:1, h:"¬°Esa es f√°cil!"}
                    ]
                }
            ];

            // --- ESTADO DEL JUEGO ---
            let state = {
                user: { name: "", phone: "" },
                score: 0,
                lvlIdx: 0,
                qIdx: 0,
                unlocked: [true, false, false, false, false],
                failed: false
            };

            // --- FUNCIONES AUXILIARES ---
            function getWeekId() {
                const d = new Date();
                const oneJan = new Date(d.getFullYear(),0,1);
                const nums = Math.floor((d - oneJan) / (24*60*60*1000));
                return d.getFullYear() + '-' + Math.ceil((d.getDay()+1+nums)/7);
            }

            function show(id) {
                document.querySelectorAll('#v-app-container > div').forEach(d => d.classList.add('v-hidden'));
                document.getElementById(id).classList.remove('v-hidden');
            }

            // --- L√ìGICA PRINCIPAL ---
            function login(e) {
                e.preventDefault();
                const n = document.getElementById('v-in-name').value;
                const p = document.getElementById('v-in-phone').value;
                
                if(!n || !p) return alert("Por favor ingresa todos los datos.");

                // Chequeo de bloqueo semanal (Local + DB logic later)
                const weekId = getWeekId();
                if(localStorage.getItem('v_played_'+p) === weekId) {
                    show('v-scr-blocked');
                    return;
                }

                state.user = { name: n, phone: p };
                document.getElementById('v-lbl-name').innerText = n;
                document.getElementById('v-score-ui').classList.remove('v-hidden');
                document.getElementById('v-score-ui').innerText = "0 pts";
                
                renderMenu();
                show('v-scr-menu');
            }

            function renderMenu() {
                const list = document.getElementById('v-levels-list');
                list.innerHTML = "";
                levelsData.forEach((l, i) => {
                    const locked = !state.unlocked[i];
                    const div = document.createElement('div');
                    div.className = `v-level-item ${locked ? 'v-locked' : ''}`;
                    div.onclick = () => !locked && startLevel(i);
                    div.innerHTML = `
                        <div>
                            <div style="font-weight:bold;">${l.name}</div>
                            <div style="font-size:0.8rem; color:#666;">${l.qs.length} preguntas</div>
                        </div>
                        <div>${locked ? 'üîí' : '‚ñ∂Ô∏è'}</div>
                    `;
                    list.appendChild(div);
                });
            }

            function startLevel(idx) {
                state.lvlIdx = idx;
                state.qIdx = 0;
                show('v-scr-game');
                loadQuestion();
            }

            function loadQuestion() {
                const l = levelsData[state.lvlIdx];
                const q = l.qs[state.qIdx];
                
                document.getElementById('v-lbl-lvlname').innerText = l.name;
                document.getElementById('v-lbl-counter').innerText = `${state.qIdx + 1}/${l.qs.length}`;
                document.getElementById('v-lbl-emoji').innerText = q.e;
                document.getElementById('v-lbl-text').innerText = q.t;
                document.getElementById('v-lbl-hint').innerText = q.h;

                // Reset UI
                document.getElementById('v-hint-box').style.display = 'none';
                document.getElementById('v-btn-next').classList.add('v-hidden');
                state.failed = false;

                // Progress Bar
                const pct = (state.qIdx / l.qs.length) * 100;
                document.getElementById('v-bar').style.width = pct + "%";

                // Opciones
                const box = document.getElementById('v-options-box');
                box.innerHTML = "";
                q.o.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = "v-opt-btn";
                    btn.innerText = opt;
                    btn.onclick = () => checkAnswer(idx, btn, q.a);
                    box.appendChild(btn);
                });
            }

            function checkAnswer(selectedIdx, btn, correctIdx) {
                const allBtns = document.querySelectorAll('.v-opt-btn');
                
                if (selectedIdx === correctIdx) {
                    btn.classList.add('v-correct');
                    allBtns.forEach(b => b.disabled = true);
                    
                    state.score += state.failed ? 50 : 100;
                    document.getElementById('v-score-ui').innerText = state.score + " pts";
                    document.getElementById('v-btn-next').classList.remove('v-hidden');
                } else {
                    btn.classList.add('v-wrong');
                    btn.disabled = true;
                    state.failed = true;
                    document.getElementById('v-hint-box').style.display = 'block';
                }
            }

            function next() {
                const l = levelsData[state.lvlIdx];
                state.qIdx++;
                
                if (state.qIdx < l.qs.length) {
                    loadQuestion();
                } else {
                    // Fin del nivel
                    if (state.lvlIdx < levelsData.length - 1) {
                        state.unlocked[state.lvlIdx + 1] = true;
                        alert("¬°Nivel Completado! üîì Desbloqueaste el siguiente.");
                        renderMenu();
                        show('v-scr-menu');
                    } else {
                        endGame();
                    }
                }
            }

           function endGame() {
                const weekId = getWeekId();
                localStorage.setItem('v_played_' + state.user.phone, weekId); // Bloqueo Local
                document.getElementById('v-final-score').innerText = state.score;

                // 1. Calcular el porcentaje de aciertos
                let totalQuestions = 0;
                levelsData.forEach(level => totalQuestions += level.qs.length);
                const maxPossibleScore = totalQuestions * 100; // 3400 puntos posibles
                const percentage = (state.score / maxPossibleScore) * 100;

                // 2. Asignar el premio seg√∫n el porcentaje
                const couponDiv = document.getElementById('v-coupon');
                
                if (percentage >= 85) {
                    // PREMIO MAYOR: 85% o m√°s (20% de descuento)
                    couponDiv.innerHTML = `
                        <strong style="color:#FF6F00;">üåü ¬°EXCELENCIA DENTAL!</strong><br>
                        <p style="font-size:0.9rem; margin:5px 0;">¬°Lograste m√°s del 85%! Tienes un <b>20% de descuento</b>.</p>
                        <span style="font-size:1.5rem; letter-spacing:2px; font-weight:bold; background:white; padding:5px 10px; display:inline-block; border:1px solid #FFCA28;">DIENTE20</span>
                    `;
                    couponDiv.classList.remove('v-hidden');
                } 
                else if (percentage >= 70) {
                    // PREMIO MEDIO: Entre 70% y 84% (10% de descuento)
                    couponDiv.innerHTML = `
                        <strong style="color:#FF6F00;">‚≠ê ¬°MUY BUEN TRABAJO!</strong><br>
                        <p style="font-size:0.9rem; margin:5px 0;">¬°Lograste m√°s del 70%! Tienes un <b>10% de descuento</b>.</p>
                        <span style="font-size:1.5rem; letter-spacing:2px; font-weight:bold; background:white; padding:5px 10px; display:inline-block; border:1px solid #FFCA28;">DIENTE10</span>
                    `;
                    couponDiv.classList.remove('v-hidden');
                } 
                else {
                    // SIN PREMIO: Menos del 70%
                    couponDiv.classList.add('v-hidden');
                }

                show('v-scr-result');

                // GUARDAR EN FIREBASE
                if(db) {
                    db.collection("ranking_vitalis").add({
                        name: state.user.name,
                        phone: state.user.phone,
                        score: state.score,
                        weekId: weekId,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => console.log("Guardado en nube"));
                }
            }

            function showRanking() {
                show('v-scr-ranking');
                const tbody = document.getElementById('v-rank-body');
                tbody.innerHTML = "<tr><td colspan='3'>Cargando ranking...</td></tr>";

                if(!db) {
                    tbody.innerHTML = "<tr><td colspan='3'>Error: Configura Firebase en el c√≥digo.</td></tr>";
                    return;
                }

                const weekId = getWeekId();
                
                db.collection("ranking_vitalis")
                    .where("weekId", "==", weekId)
                    .orderBy("score", "desc")
                    .limit(10)
                    .get()
                    .then((snapshot) => {
                        tbody.innerHTML = "";
                        if (snapshot.empty) {
                            tbody.innerHTML = "<tr><td colspan='3'>A√∫n no hay puntajes esta semana.</td></tr>";
                            return;
                        }
                        
                        let rank = 1;
                        snapshot.forEach((doc) => {
                            const data = doc.data();
                            const tr = document.createElement('tr');
                            if(data.name === state.user.name) tr.className = "v-user-row";
                            
                            let medal = rank;
                            if(rank===1) medal="ü•á";
                            if(rank===2) medal="ü•à";
                            if(rank===3) medal="ü•â";

                            tr.innerHTML = `<td>${medal}</td><td>${data.name}</td><td style="text-align:right">${data.score}</td>`;
                            tbody.appendChild(tr);
                            rank++;
                        });
                    })
                    .catch((error) => {
                        console.error("Error ranking:", error);
                        tbody.innerHTML = "<tr><td colspan='3'>Error cargando datos.</td></tr>";
                    });
            }

            return { login, next, showRanking };

        })();
    </script>
</section> <footer class="site-footer">
        <div class="footer-content">
            
            <div class="footer-section">
                <h3 style="color: white; font-size: 1.5rem; margin-top: 0;">Vitalis</h3>
                <p>Tu sonrisa en manos expertas. Cuidamos la salud dental de toda tu familia con especialistas de primer nivel.</p>
                <div class="social-icons">
                    <a href="https://www.instagram.com/vitalis.clinica.odontologica/" target="_blank" aria-label="Instagram">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                    </a>
                    <a href="https://www.facebook.com/people/Vitalis-Cl%C3%ADnica-Odontol%C3%B3gica/100090133734205/" target="_blank" aria-label="Facebook">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>
                    </a>
                </div>
            </div>

            <div class="footer-section">
                <h3>Explora</h3>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="especialidades.html">Especialidades</a></li>
                    <li><a href="equipo.html">Nuestro Equipo</a></li>
                    <li><a href="educacion.html">Info Educativa</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Vis√≠tanos</h3>
                <p>üìç Gabriela Mistral 79, Malalhue</p>
                <p>üì± +56 9 5700 6747</p>
                <p>üïí Lun a Vie: 09:00 - 20:00</p>
                <p>üïí Sabados: 09:00 - 15:00</p>
                <p><strong>üïí Urgencias: 24/7</strong> </p>
            </div>

        </div>

        <div class="footer-bottom">
            <p>&copy; 2022 Vitalis Cl√≠nica Odontol√≥gica. Todos los derechos reservados.</p>
        </div>
    </footer>
    <script>
    function toggleMenu() {
        const menu = document.getElementById('menu-links');
        // Esto pone o quita la clase "active" que definimos en el CSS
        if (menu.style.display === "flex") {
            menu.style.display = "none";
        } else {
            menu.style.display = "flex";
        }
    }
</script>
    <a href="https://wa.me/56957006747?text=Hola,%20me%20gustar√≠a%20agendar%20una%20evaluaci√≥n%20en%20Vitalis." class="btn-flotante-wsp" target="_blank" aria-label="Contactar por WhatsApp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" width="35" height="35" fill="white">
            <path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/>
        </svg>
    </a>
</body>
</html>

</body>
</html>
</body>
</html>
