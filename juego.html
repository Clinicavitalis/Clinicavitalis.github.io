<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vitalis | ClÃ­nica OdontolÃ³gica</title>
    <link rel="stylesheet" href="style.css">>

</head>
<body>

    <nav>
    <div class="logo-container">
        <img src="img/logo.png" alt="Vitalis" class="logo-img" style="height: 50px;">
    </div>
    
    <div class="hamburger" onclick="toggleMenu()">
        â˜°
    </div>

    <div class="nav-links" id="menu-links">
        <a href="index.html">Inicio</a>
        <a href="especialidades.html">Especialidades</a>
        <a href="equipo.html">Equipo</a>
        <a href="juego.html">Jugar</a>
        <a href="https://wa.me/56900000000">Contacto</a>
    </div>
</nav>

    <header class="hero">
        <h1>Tu sonrisa en manos expertas</h1>
        <p>Gabriela Mistral 79, Malalhue</p>
        <a href="https://wa.me/56957006747" class="btn-whatsapp">Agendar EvaluaciÃ³n</a>
    </header>

    <section id="quiz-section">
        <h2 class="section-title" style="margin-bottom: 10px;">Reto Vitalis: Master Dental</h2>
        <p style="text-align:center; margin-bottom: 30px;">Â¡Juega y gana descuentos exclusivos en tu tratamiento!</p>
        
       <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vitalis - Master Dental</title>
    <style>
        :root {
            --bg-color: #EBF5FB;
            --primary: #29B6F6;  /* Celeste Vitalis */
            --dark-blue: #01579B;
            --white: #FFFFFF;
            --success: #66BB6A;
            --error: #EF5350;
            --locked: #CFD8DC;
            --text-gray: #455A64;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            color: var(--dark-blue);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, #ffffff 0%, #E1F5FE 100%);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-box {
            width: 45px;
            height: 45px;
            background: var(--white);
            border-radius: 50%;
            border: 2px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        .brand-name {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--dark-blue);
            line-height: 1.1;
        }

        /* --- CONTENEDOR --- */
        .container {
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
            min-height: 80vh;
        }

        /* --- TARJETAS Y PANTALLAS --- */
        .card {
            background: var(--white);
            padding: 25px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(41, 182, 246, 0.15);
            text-align: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: var(--text-gray);
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #B3E5FC;
            border-radius: 10px;
            font-size: 1rem;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s;
        }
        input:focus { border-color: var(--primary); }

        /* --- RANKING TABLE --- */
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .ranking-table th {
            text-align: left;
            padding: 10px;
            color: var(--primary);
            font-size: 0.9rem;
            border-bottom: 2px solid #E1F5FE;
        }
        .ranking-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
            color: var(--text-gray);
        }
        .user-highlight { background-color: #E1F5FE; font-weight: bold; color: var(--dark-blue) !important; }

        /* --- MENÃš DE NIVELES --- */
        .mascot-container {
            background: var(--white);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(41, 182, 246, 0.15);
            border: 2px solid #B3E5FC;
        }
        .mascot-avatar { font-size: 3rem; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .level-card {
            background: var(--white);
            padding: 15px 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            cursor: pointer;
            margin-bottom: 15px;
            border-left: 6px solid var(--primary);
            transition: transform 0.2s;
        }
        .level-card:active { transform: scale(0.98); }
        .level-card.locked { 
            background-color: #ECEFF1; 
            border-left-color: var(--locked); 
            opacity: 0.7;
            pointer-events: none;
        }

        /* --- PREGUNTA --- */
        .question-text {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
            color: #263238;
        }
        
        .option-btn {
            background: var(--bg-color);
            border: 2px solid transparent;
            padding: 15px;
            border-radius: 12px;
            font-size: 1rem;
            color: var(--dark-blue);
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            text-align: left;
            transition: all 0.2s;
        }
        .option-btn:active { background: #dcedf7; }
        .option-btn.correct { background: #E8F5E9; border-color: var(--success); color: #2E7D32; }
        .option-btn.wrong { background: #FFEBEE; border-color: var(--error); color: #C62828; opacity: 0.6; }

        /* --- UI ELEMENTS --- */
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(41, 182, 246, 0.4);
            margin-top: 10px;
        }
        .btn-secondary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
        }

        .hidden { display: none !important; }
        .hint-box { background: #FFF3E0; border: 1px solid #FFCC80; color: #E65100; padding: 15px; border-radius: 10px; margin-top: 15px; display: none; text-align: left; font-size: 0.95rem; }
        .emoji-header { font-size: 3.5rem; display: block; margin-bottom: 10px; }

    </style>
</head>
<body>

    <header>
        <div class="brand-container">
            <div class="logo-box">V</div>
            <div>
                <div class="brand-name">Vitalis</div>
                <div style="font-size: 0.75rem; opacity: 0.8;">ClÃ­nica OdontolÃ³gica</div>
            </div>
        </div>
        <div id="score-display" class="hidden" style="font-size: 0.9rem; font-weight: bold; color: var(--primary);">
            <span id="current-points">0</span> pts
        </div>
    </header>

    <div class="container">

        <div id="screen-login">
            <div class="card">
                <div class="emoji-header">ğŸ‘‹</div>
                <h2 style="color: var(--primary); margin-top:0;">Â¡Bienvenido a Vitalis!</h2>
                <p style="color: #666; font-size: 0.95rem;">
                    Demuestra cuÃ¡nto sabes sobre tu sonrisa y gana premios exclusivos.
                </p>

                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Tu Nombre</label>
                        <input type="text" id="input-name" placeholder="Ej: SofÃ­a" required>
                    </div>
                    <div class="form-group">
                        <label>TelÃ©fono (Sin espacios)</label>
                        <input type="tel" id="input-phone" placeholder="Ej: 987654321" required>
                    </div>
                    <div class="form-group">
                        <label>Correo de PapÃ¡/MamÃ¡</label>
                        <input type="email" id="input-email" placeholder="Ej: correo@gmail.com" required>
                    </div>
                    <button type="submit" class="btn-primary">Â¡Empezar Aventura!</button>
                    <button type="button" class="btn-secondary" onclick="showRankingOnly()">Ver Ranking General</button>
                </form>
            </div>
        </div>

        <div id="screen-blocked" class="hidden card">
            <div class="emoji-header">â³</div>
            <h2>Â¡Ya jugaste esta semana!</h2>
            <p>Hola <b id="blocked-name"></b>. Para que la competencia sea justa, solo puedes registrar un puntaje por semana.</p>
            <p>Â¡Vuelve el prÃ³ximo lunes para superar tu rÃ©cord!</p>
            <button class="btn-secondary" onclick="showRankingOnly()">Ver Tabla de Posiciones</button>
        </div>

        <div id="screen-menu" class="hidden">
            <div class="mascot-container">
                <div class="mascot-avatar">ğŸ¦·</div>
                <div style="flex:1">
                    <p style="margin:0; font-size:0.9rem; color:#666;">Jugador: <b id="player-name-display"></b></p>
                    <p style="margin:5px 0 0; font-weight:bold; color:var(--dark-blue); font-size: 0.95rem;" id="mascot-text">Â¡Completa todos los niveles para ver tu posiciÃ³n!</p>
                </div>
            </div>

            <div id="levels-container">
                </div>
            
            <button class="btn-secondary" style="margin-top: 20px;" onclick="showRankingOnly(true)">Ver Ranking Actual</button>
        </div>

        <div id="screen-game" class="hidden">
            <div class="card" style="padding-top: 15px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-size:0.85rem; color:#999;">
                    <span id="level-indicator">Nivel 1</span>
                    <span id="question-indicator">1/6</span>
                </div>
                
                <div style="background:#ECEFF1; height:6px; border-radius:3px; margin-bottom:20px; width:100%;">
                    <div id="q-progress" style="background:var(--primary); height:100%; width:0%; transition: width 0.3s; border-radius:3px;"></div>
                </div>

                <span id="q-emoji" class="emoji-header" style="font-size: 4rem;">ğŸ¤”</span>
                <p id="q-text" class="question-text">Pregunta...</p>
                
                <div id="options-box"></div>

                <div id="hint-box" class="hint-box">
                    ğŸ’¡ <b>Pista:</b> <span id="hint-text"></span>
                </div>

                <button id="next-btn" class="btn-primary hidden" onclick="nextQuestion()">Siguiente Pregunta â¡ï¸</button>
            </div>
        </div>

        <div id="screen-result" class="hidden card">
            <div class="emoji-header">ğŸ‰</div>
            <h2 style="color:var(--primary);">Â¡MisiÃ³n Cumplida!</h2>
            <p>Has completado el entrenamiento de Vitalis.</p>
            
            <div style="background: #E3F2FD; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <span style="display:block; font-size:0.9rem; color:#666;">PUNTAJE FINAL</span>
                <span id="final-score-display" style="font-size:3.5rem; font-weight:800; color:var(--dark-blue); line-height:1;">0</span>
            </div>

            <div id="coupon-container" class="hidden" style="border: 2px dashed #FFCA28; background: #FFF8E1; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <strong style="color: #FF6F00;">ğŸŒŸ Â¡EXCELENCIA DENTAL! ğŸŒŸ</strong><br>
                <p style="font-size:0.9rem; margin:10px 0;">Lograste mÃ¡s del 85% de aciertos.</p>
                <div style="background:white; padding:10px; font-weight:bold; font-size:1.2rem; letter-spacing:2px; border:1px solid #FFCA28;">DIENTE20</div>
                <p style="font-size:0.75rem; margin-top:5px;">Muestra esto en recepciÃ³n para tu 20% dscto.</p>
            </div>

            <button class="btn-primary" onclick="showRankingOnly()">Ver Ranking Semanal</button>
        </div>

        <div id="screen-ranking" class="hidden">
            <div class="card" style="padding: 15px;">
                <h2 style="color: var(--primary); margin-bottom: 5px;">ğŸ† Ranking Semanal</h2>
                <p style="font-size:0.8rem; color:#777; margin-bottom: 20px;">Los mejores exploradores dentales de esta semana</p>
                
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th width="15%">#</th>
                            <th width="60%">Explorador</th>
                            <th width="25%" style="text-align:right;">Pts</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-body">
                        </tbody>
                </table>
                <br>
                <button class="btn-secondary" onclick="location.reload()">Volver al Inicio</button>
            </div>
        </div>

    </div>

    <script>
        // --- BASE DE DATOS ACTUALIZADA ---
        // CombinaciÃ³n de preguntas directas (Niveles iniciales) y situacionales (Niveles avanzados)
        const levelsData = [
            { 
                id: 1, name: "Nivel 1: AnatomÃ­a BÃ¡sica", count: 6, qs: [
                    // Preguntas Directas
                    {e:"ğŸ›¡ï¸", t:"Â¿CuÃ¡l es la capa mÃ¡s externa y dura del diente?", o:["El Esmalte","La Dentina","La Pulpa","La EncÃ­a"], a:0, h:"Es la parte blanca y brillante que ves al sonreÃ­r."},
                    {e:"ğŸ‘¶", t:"Â¿CuÃ¡ntos dientes de leche tiene un niÃ±o?", o:["32 dientes","20 dientes","10 dientes","50 dientes"], a:1, h:"Son 10 arriba y 10 abajo."},
                    {e:"âš“", t:"Â¿QuÃ© parte del diente lo mantiene pegado al hueso?", o:["La Corona","El Esmalte","La RaÃ­z","La Lengua"], a:2, h:"Es la parte larga que estÃ¡ escondida bajo la encÃ­a."},
                    {e:"ğŸ’—", t:"Â¿CÃ³mo se llama la parte rosada que rodea los dientes?", o:["Labio","Mejilla","EncÃ­a","Paladar"], a:2, h:"Es suave, de color rosa y protege el cuello del diente."},
                    {e:"âš¡", t:"Â¿QuÃ© hay justo en el centro del diente?", o:["Hueso","Aire","Pulpa (Nervio)","Agua"], a:2, h:"Es la parte viva que siente el frÃ­o y el calor."},
                    {e:"ğŸ§›", t:"Â¿QuÃ© dientes usamos para desgarrar la comida?", o:["Molares","Incisivos","Caninos (Colmillos)","Premolares"], a:2, h:"Son los dientes puntiagudos en las esquinas."},
                ]
            },
            { 
                id: 2, name: "Nivel 2: Higiene Diaria", count: 7, qs: [
                    // Preguntas Directas + Funciones
                    {e:"ğŸª¥", t:"Â¿CuÃ¡l es la cantidad mÃ­nima de veces que debes cepillarte al dÃ­a?", o:["1 vez","2 veces","5 veces","Solo los domingos"], a:1, h:"Una por la maÃ±ana y otra (la mÃ¡s importante) por la noche."},
                    {e:"ğŸ§µ", t:"Â¿QuÃ© herramienta sirve para limpiar ENTRE los dientes?", o:["Cepillo normal","Enjuague bucal","Hilo Dental","Palillos"], a:2, h:"Es un hilo muy fino que entra donde el cepillo no llega."},
                    {e:"ğŸ¦ ", t:"Â¿QuÃ© comen las bacterias para producir caries?", o:["Agua","AzÃºcar","Verduras","Aire"], a:1, h:"Les encantan los dulces y golosinas."},
                    {e:"ğŸ“…", t:"Â¿Cada cuÃ¡nto tiempo debes cambiar tu cepillo de dientes?", o:["Cada 3 meses","Cada aÃ±o","Nunca","Cada semana"], a:0, h:"O antes si las cerdas estÃ¡n abiertas y despeinadas."},
                    {e:"ğŸ¦·", t:"Â¿QuÃ© pasta de dientes ayuda a fortalecer el esmalte?", o:["Con Sabor a fresa","Con FlÃºor","Con AzÃºcar","Con Sal"], a:1, h:"El FlÃºor es el mineral que hace al diente mÃ¡s fuerte."},
                    {e:"ğŸ©¸", t:"Si te sangra la encÃ­a al cepillar, Â¿quÃ© debes hacer?", o:["Dejar de cepillar","Cepillar mejor esa zona","Comer helado","No hacer nada"], a:1, h:"Sangra porque hay bacterias. Si limpias bien, deja de sangrar."},
                    {e:"ğŸ", t:"Â¿QuÃ© alimento ayuda a limpiar tus dientes al morderlo?", o:["Galletas","Manzana","Caramelo","Pan"], a:1, h:"Es una fruta dura y fibrosa que barre la suciedad."}
                ]
            },
            { 
                id: 3, name: "Nivel 3: Situaciones Reales", count: 7, qs: [
                    // IntroducciÃ³n de preguntas situacionales
                    {e:"ğŸ¥¤", t:"EstÃ¡s en el cine y pides una Gaseosa (Soda). Â¿Por quÃ© es mala para tus dientes?", o:["Porque estÃ¡ frÃ­a","Tiene mucho Ãcido y AzÃºcar","Porque tiene gas","No es mala"], a:1, h:"El Ã¡cido ablanda el diente y el azÃºcar alimenta bacterias."},
                    {e:"â„ï¸", t:"Muerdes un helado y sientes un dolor rÃ¡pido y agudo. Â¿QuÃ© podrÃ­a ser?", o:["Sensibilidad dental","Que el helado estÃ¡ malo","Es normal","Dolor de cabeza"], a:0, h:"Ocurre cuando el esmalte estÃ¡ desgastado o hay una caries."},
                    {e:"ğŸ¾", t:"No tienes destapador y quieres abrir una botella con los dientes. Â¿Lo haces?", o:["SÃ­, soy fuerte","Claro que sÃ­","Â¡Nunca! Se pueden romper","Solo una vez"], a:2, h:"Los dientes son joyas, no herramientas."},
                    {e:"ğŸ˜´", t:"Te vas a dormir sin lavarte los dientes. Â¿QuÃ© pasa en la noche?", o:["Nada","Las bacterias atacan mÃ¡s porque hay menos saliva","Los dientes descansan","Se caen"], a:1, h:"La saliva nos protege, pero al dormir la boca se seca."},
                    {e:"ğŸ¤", t:"Â¿QuÃ© pasa si te chupas el dedo hasta muy grande?", o:["Los dientes se enchuecan","Se ponen blancos","Crecen mÃ¡s rÃ¡pido","Nada"], a:0, h:"El dedo empuja los dientes hacia afuera y deforma la mordida."},
                    {e:"ğŸ‘…", t:"Â¿Por quÃ© es importante cepillar tambiÃ©n la lengua?", o:["Para que se vea rosa","Para evitar el mal aliento","Para saborear mejor","No es necesario"], a:1, h:"La lengua guarda muchas bacterias que causan mal olor."},
                    {e:"ğŸš‘", t:"Jugando fÃºtbol se te sale un diente definitivo entero (con raÃ­z). Â¿QuÃ© haces?", o:["Lo boto","Lo lavo con jabÃ³n","Lo pongo en leche y voy al dentista","Lloro"], a:2, h:"Â¡Nunca lo laves con jabÃ³n! La leche ayuda a mantenerlo vivo para reimplantarlo."}
                ]
            },
            { 
                id: 4, name: "Nivel 4: AnatomÃ­a Avanzada", count: 7, qs: [
                    // Conceptos mÃ¡s tÃ©cnicos solicitados + AnatomÃ­a interna
                    {e:"ğŸ—ï¸", t:"Â¿Para quÃ© sirve el Ligamento Periodontal?", o:["Para que el diente se vea blanco","Amortigua y une el diente al hueso","Produce saliva","Cubre la corona"], a:1, h:"Es como un 'colchÃ³n' elÃ¡stico entre la raÃ­z y el hueso."},
                    {e:"ğŸ’", t:"Â¿CuÃ¡l es la sustancia biolÃ³gica mÃ¡s dura de todo el cuerpo humano?", o:["El Hueso","El Esmalte Dental","Las UÃ±as","El CrÃ¡neo"], a:1, h:"Es incluso mÃ¡s duro que tus huesos."},
                    {e:"ğŸšª", t:"Las muelas tienen grietas profundas. Â¿QuÃ© tratamiento las cubre para evitar caries?", o:["Sellantes","Frenillos","ExtracciÃ³n","Blanqueamiento"], a:0, h:"Es una capa plÃ¡stica que tapa los surcos para que no entre comida."},
                    {e:"ğŸ‘´", t:"Â¿CÃ³mo se llaman las Ãºltimas muelas que salen (entre los 17 y 21 aÃ±os)?", o:["Premolares","Caninos","Muelas del Juicio (Terceros Molares)","Incisivos"], a:2, h:"A veces no tienen espacio para salir y hay que sacarlas."},
                    {e:"ğŸ¤¤", t:"Â¿CuÃ¡l es la funciÃ³n principal de la Saliva?", o:["Solo mojar la comida","Neutralizar Ã¡cidos y proteger dientes","Darnos sed","Ninguna"], a:1, h:"Es el defensor natural de tu boca contra el ataque Ã¡cido."},
                    {e:"ğŸ§±", t:"Â¿QuÃ© es el Sarro?", o:["Placa bacteriana endurecida","Restos de comida","Manchas de cafÃ©","Diente roto"], a:0, h:"Cuando la placa no se limpia, se calcifica y se pone dura como piedra."},
                    {e:"ğŸ˜¬", t:"Â¿QuÃ© es el Bruxismo?", o:["Comer mucho","Rechinar o apretar los dientes al dormir","Tener caries","Miedo al dentista"], a:1, h:"Suele pasar cuando estÃ¡s estresado y desgasta los dientes."}
                ]
            },
            { 
                id: 5, name: "Nivel 5: Experto Vitalis", count: 7, qs: [
                    // Nivel final mixto difÃ­cil
                    {e:"ğŸ“¸", t:"Â¿QuÃ© usa el dentista para ver DENTRO del hueso y entre los dientes?", o:["Lupa","Espejo","RadiografÃ­a","Microscopio"], a:2, h:"Una imagen en blanco y negro que revela lo invisible."},
                    {e:"ğŸ¤¢", t:"Â¿QuÃ© es la Halitosis?", o:["Dientes blancos","Tener frenillos","Mal aliento crÃ³nico","Dolor de muelas"], a:2, h:"Es el tÃ©rmino mÃ©dico para el olor desagradable de la boca."},
                    {e:"ğŸš§", t:"Â¿QuÃ© hacen los 'Brackets' o Frenillos?", o:["Liman los dientes","Mueven los dientes a su posiciÃ³n correcta","Solo decoran","Blanquean"], a:1, h:"Usan fuerzas suaves para alinear tu sonrisa."},
                    {e:"ğŸ¬", t:"Â¿QuÃ© tipo de dulce es el MÃS daÃ±ino para los dientes?", o:["Chocolate","Caramelo pegajoso (Masticable)","Helado","Gelatina"], a:1, h:"Al pegarse al diente, el azÃºcar ataca por mucho mÃ¡s tiempo."},
                    {e:"ğŸ›¡ï¸", t:"Â¿CuÃ¡l es la mejor forma de NO tener dolor de muelas nunca?", o:["Tomar pastillas","La PrevenciÃ³n (Revisiones y limpieza)","No comer nada","Usar enjuague"], a:1, h:"Ir al dentista antes de que duela es el secreto."},
                    {e:"ğŸ‘¨â€âš•ï¸", t:"Â¿QuiÃ©n es el especialista en niÃ±os?", o:["El Ortodoncista","El Odontopediatra","El Cirujano","El Periodoncista"], a:1, h:"Odonto = Diente, Pediatra = NiÃ±os."},
                    {e:"ğŸ", t:"Â¿DÃ³nde consigues la mejor sonrisa?", o:["En la panaderÃ­a","En Vitalis ClÃ­nica OdontolÃ³gica","En el parque","En la farmacia"], a:1, h:"Â¡Esa es fÃ¡cil!"}
                ]
            }
        ];

        // --- ESTADO Y LÃ“GICA (IdÃ©ntico a la versiÃ³n anterior para mantener funciones) ---
        let state = {
            user: { name: "", phone: "", email: "" },
            score: 0,
            currentLevel: 0,
            currentQ: 0,
            levelsUnlocked: [true, false, false, false, false],
            failedAttempt: false
        };

        const fakeRanking = [
            { name: "MartÃ­n G.", score: 4100 },
            { name: "Isabella R.", score: 3950 },
            { name: "TomÃ¡s L.", score: 3800 },
            { name: "Valentina P.", score: 3650 },
            { name: "Javier S.", score: 3200 }
        ];

        function handleLogin(e) {
            e.preventDefault();
            const name = document.getElementById('input-name').value;
            const phone = document.getElementById('input-phone').value;
            const email = document.getElementById('input-email').value;

            // Bloqueo Semanal
            const lastPlayed = localStorage.getItem('vitalis_played_' + phone);
            const now = new Date().getTime();
            const oneWeek = 7 * 24 * 60 * 60 * 1000;

            if (lastPlayed && (now - lastPlayed) < oneWeek) {
                document.getElementById('blocked-name').innerText = name;
                switchScreen('screen-blocked');
                return;
            }

            state.user = { name, phone, email };
            document.getElementById('player-name-display').innerText = name;
            switchScreen('screen-menu');
            renderLevels();
            document.getElementById('score-display').classList.remove('hidden');
        }

        function switchScreen(id) {
            document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function renderLevels() {
            const c = document.getElementById('levels-container');
            c.innerHTML = "";
            levelsData.forEach((l, i) => {
                const locked = !state.levelsUnlocked[i];
                const d = document.createElement('div');
                d.className = `level-card ${locked ? 'locked' : ''}`;
                d.onclick = () => !locked && startLevel(i);
                d.innerHTML = `
                    <div>
                        <div style="font-weight:bold;">${l.name}</div>
                        <div style="font-size:0.8rem; color:#666;">${l.count} preguntas</div>
                    </div>
                    <div>${locked ? 'ğŸ”’' : 'â–¶ï¸'}</div>
                `;
                c.appendChild(d);
            });
        }

        function startLevel(idx) {
            state.currentLevel = idx;
            state.currentQ = 0;
            switchScreen('screen-game');
            loadQuestion();
        }

        function loadQuestion() {
            const l = levelsData[state.currentLevel];
            const q = l.qs[state.currentQ];

            document.getElementById('level-indicator').innerText = l.name;
            document.getElementById('question-indicator').innerText = `${state.currentQ + 1}/${l.count}`;
            document.getElementById('q-emoji').innerText = q.e;
            document.getElementById('q-text').innerText = q.t;
            document.getElementById('hint-text').innerText = q.h;

            const box = document.getElementById('options-box');
            box.innerHTML = "";
            document.getElementById('hint-box').style.display = 'none';
            document.getElementById('next-btn').classList.add('hidden');
            state.failedAttempt = false;

            const pct = (state.currentQ / l.count) * 100;
            document.getElementById('q-progress').style.width = pct + "%";

            q.o.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(idx, btn, q.a);
                box.appendChild(btn);
            });
        }

        function checkAnswer(selIdx, btn, corrIdx) {
            const btns = document.querySelectorAll('.option-btn');
            if (selIdx === corrIdx) {
                btn.classList.add('correct');
                btns.forEach(b => b.disabled = true);
                state.score += state.failedAttempt ? 50 : 100;
                document.getElementById('current-points').innerText = state.score;
                document.getElementById('next-btn').classList.remove('hidden');
            } else {
                btn.classList.add('wrong');
                btn.disabled = true;
                state.failedAttempt = true;
                document.getElementById('hint-box').style.display = 'block';
            }
        }

        function nextQuestion() {
            const l = levelsData[state.currentLevel];
            state.currentQ++;
            if (state.currentQ < l.count) {
                loadQuestion();
            } else {
                if (state.currentLevel < levelsData.length - 1) {
                    state.levelsUnlocked[state.currentLevel + 1] = true;
                    alert("Â¡Nivel Completado! ğŸ”“ Desbloqueaste el siguiente nivel.");
                    switchScreen('screen-menu');
                    renderLevels();
                } else {
                    finishGame();
                }
            }
        }

        function finishGame() {
            localStorage.setItem('vitalis_played_' + state.user.phone, new Date().getTime());
            saveScore(state.user.name, state.score);
            switchScreen('screen-result');
            document.getElementById('final-score-display').innerText = state.score;

            // Ajuste de cÃ¡lculo para ganar el cupÃ³n (aprox 85% de 3400 pts posibles)
            if (state.score >= 2900) {
                document.getElementById('coupon-container').classList.remove('hidden');
            }
        }

        function saveScore(name, score) {
            let r = JSON.parse(localStorage.getItem('vitalis_ranking') || '[]');
            if(r.length===0) r = [...fakeRanking];
            r.push({name, score});
            r.sort((a,b) => b.score - a.score);
            localStorage.setItem('vitalis_ranking', JSON.stringify(r));
        }

        function showRankingOnly(fromMenu) {
            let r = JSON.parse(localStorage.getItem('vitalis_ranking') || '[]');
            if(r.length===0) r = [...fakeRanking];
            
            const tbody = document.getElementById('ranking-body');
            tbody.innerHTML = "";
            
            r.slice(0, 10).forEach((e, i) => {
                const tr = document.createElement('tr');
                if(e.name === state.user.name) tr.classList.add('user-highlight');
                tr.innerHTML = `<td>${i+1}</td><td>${e.name}</td><td style="text-align:right;">${e.score}</td>`;
                tbody.appendChild(tr);
            });
            switchScreen('screen-ranking');
        }
    </script>
</body>
</html>

</body>
</html>
